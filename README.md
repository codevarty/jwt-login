# Spring, Spring Security, Redis, JWT 를 이용한 인증 서비스

## 개발 목표
Redis를 사용하여 중복 로그인 문제를 해결하는 데 중점을 두고 개발을 진행하였습니다.

## 개발 환경
- Spring Boot 3.3
- Spring Security 6
- jjwt (jwt 라이브러리) 0.12.6
- redis

## 중복 로그인 해결 방법

현재 프로젝트에서 해결한 방법을 순서도로 간단히 그려보았습니다.
>
![jwt-tutorial-중복 로그인 체크 과정 drawio](https://github.com/user-attachments/assets/07fe41ba-1b6a-4965-b20a-6c67a04a6c6d)
1. 사용자가 로그인 시도를 한다.
2. 아이디(현재 프로젝트에서는 유저네임)를 가져온다.
3. Redis에 유저 아이디로 키로 되어 있는 Access Token이 저장 되어 있는지 확인한다.
4. 저장되어 있으면 로그인 거부를 하고 없으면 데이터베이스에 사용자 정보를 확인하고 토큰을 생성해 발급한다.


## 개발하면서 발생한 문제점 및 해결 방법
1. 전에 발급한 토큰 재사용성
   - 로그아웃을 하는 경우 기존에 사용하던 토큰을 다시 사용할 수 있다는 문제점이 있었습니다.
   - 해당 문제를 해결하기 위해 Redis에 BlackList 를 도입해 기존에 사용하던 토큰이 이 리스트에 등록이 되면 사용할 수 없게 처리를 하였습니다.
     
3. JwtProvider 와 TokenService 책임 문제.
   - 아직 스프링 개발에 익숙치 않아서 각 코드에 정확한 책임을 부여하는데 상당한 어려움이 있었습니다.
   - 인터넷 글을 보고 필요한 코드를 도입하면서 생기는 문제로 코드가 뒤죽박죽으로 섞이게 되고 각 클래스마다 담당하는 책임이 모호해지는 문제가 있었습니다.
   - 이러한 문제를 해결하기 위해 순서도를 사용하는 등 JWT 인증 과정을 다시 정리를 하고 각 클래스에 대한 책임을 정할 수 있게 되었습니다.
